;-------------------------------------------------
;獣姦
;人外系コマンド
;-------------------------------------------------
@COM381

PRINTL 獣姦
STR:0 = 獣姦

CALL KOJO_MESSAGE_COM

;ＡとＶ両方開いていない
IF (TEQUIP:貞操帯 || TEQUIP:バイブ && ABL:Ｖ感覚 <= 5 || TALENT:オトコ) && (TEQUIP:アナルバイブ && ABL:Ａ感覚 <= 5 || TEQUIP:アナルビーズ || TEQUIP:拡張バルーン)
	TFLAG:705 = 4
;Ｖが埋まっているかオトコの場合、Ａを使う
ELSEIF TEQUIP:貞操帯 || TEQUIP:バイブ && ABL:Ｖ感覚 <= 5 || TALENT:オトコ
	SIF TALENT:バックバージン
		TFLAG:161 |= 1
	TFLAG:705 = 1
;Ａ開発済でもＶが空いていればＶに挿入
ELSEIF (!TEQUIP:貞操帯 || !TEQUIP:バイブ) && TEQUIP:アナルバイブ && ABL:Ａ感覚 >= 6
	;V経験を伴うコマンドのフラグ(処女膜再生対応)
	SIF TALENT:処女 || TALENT:再生処女
		TFLAG:19 |= 1
	TFLAG:705 = 0
;Ｖが埋まっていてＡが開発済の場合、Ａを使う
ELSEIF (TEQUIP:貞操帯 || TEQUIP:バイブ) && TEQUIP:アナルバイブ && ABL:Ａ感覚 >= 6
	SIF TALENT:バックバージン
		TFLAG:161 |= 1
	TFLAG:705 = 1
;その他はＶに挿入
ELSE
	;V経験を伴うコマンドのフラグ(処女膜再生対応)
	SIF TALENT:処女 || TALENT:再生処女
		TFLAG:19 |= 1
	TFLAG:705 = 0
ENDIF

;ストッキングびりびりフラグ
IF TEQUIP:特殊２ == 5 || TEQUIP:特殊２ == 6
	TFLAG:55 = 1
ENDIF

;-------------------------------------------------
;ソース追加処理
;-------------------------------------------------
;消費体力、気力
LOSEBASE:体力 += 100
LOSEBASE:気力 += 250

SOURCE:痛み += 700
SOURCE:恐れ += 1000
SOURCE:屈従 += 1200
SOURCE:不潔 += 800
SOURCE:逸脱 += 1000
SOURCE:反発 += 1000

;下半身着衣、又はＡとＶ両方開いていない
IF TFLAG:705 == 4
;オトコ、又はＶに道具挿入
ELSEIF TFLAG:705 == 1
	SOURCE:快Ａ += 200
	SOURCE:痛み += 400
	SOURCE:恐れ += 400
ELSEIF TFLAG:705 == 0
	SOURCE:快Ｖ += 200
	SOURCE:痛み += 400
	SOURCE:恐れ += 400
ENDIF

;-------------------------------------------------
;特殊ソース処理
;-------------------------------------------------
;ＡとＶ両方開いていない
IF TFLAG:705 == 4
;オトコ、又はＶに道具挿入
ELSEIF TFLAG:705 == 1
	;Aへの苦痛は先に処理しておく
	;EXP:Ａ経験をみる
	IF EXP:Ａ経験 < EXPLV:1
		TIMES SOURCE:痛み , 3.00
		TIMES SOURCE:反発 , 3.00
	ELSEIF EXP:Ａ経験 < EXPLV:2
		TIMES SOURCE:痛み , 1.20
		TIMES SOURCE:反発 , 2.00
	ELSEIF EXP:Ａ経験 < EXPLV:3
		TIMES SOURCE:痛み , 0.80
		TIMES SOURCE:反発 , 1.50
	ELSEIF EXP:Ａ経験 < EXPLV:4
		TIMES SOURCE:痛み , 0.60
		TIMES SOURCE:反発 , 1.20
	ELSEIF EXP:Ａ経験 < EXPLV:5
		TIMES SOURCE:痛み , 0.40
	ELSEIF EXP:Ａ経験 >= EXPLV:5
		TIMES SOURCE:痛み , 0.20
	ENDIF

	;PALAM:潤滑をみる
	IF PALAM:潤滑 < PALAMLV:1
		TIMES SOURCE:痛み , 1.20
		TIMES SOURCE:反発 , 2.00
	ELSEIF PALAM:潤滑 < PALAMLV:2
		TIMES SOURCE:痛み , 1.00
		TIMES SOURCE:反発 , 1.50
	ELSEIF PALAM:潤滑 < PALAMLV:3
		TIMES SOURCE:痛み , 0.60
	ELSEIF PALAM:潤滑 < PALAMLV:4
		TIMES SOURCE:痛み , 0.30
	ELSEIF PALAM:潤滑 >= PALAMLV:4
		TIMES SOURCE:痛み , 0.20
	ENDIF
ELSEIF TFLAG:705 == 0
	;処女だった場合は、苦痛のソースと反発のソースを追加する
	IF TALENT:処女
		SOURCE:痛み += 5000
		SOURCE:反発 += 3000
	;再生処女だった場合は、苦痛のソースと反発のソースを追加する
	ELSEIF TALENT:再生処女
		SOURCE:痛み += 5000
		SOURCE:反発 += 1000
	ENDIF
	
	;Vへの苦痛は先に処理しておく
	;EXP:Ｖ経験をみる（処女の反感は別途処理済みなので省略）
	IF EXP:Ｖ経験 < EXPLV:1
		TIMES SOURCE:痛み , 2.50
	ELSEIF EXP:Ｖ経験 < EXPLV:2
		TIMES SOURCE:痛み , 0.80
		TIMES SOURCE:反発 , 1.20
	ELSEIF EXP:Ｖ経験 < EXPLV:3
		TIMES SOURCE:痛み , 0.40
	ELSEIF EXP:Ｖ経験 < EXPLV:4
		TIMES SOURCE:痛み , 0.10
	ELSEIF EXP:Ｖ経験 < EXPLV:5
		TIMES SOURCE:痛み , 0.00
	ELSEIF EXP:Ｖ経験 >= EXPLV:5
		TIMES SOURCE:痛み , 0.00
	ENDIF
	
	;PALAM:潤滑をみる
	IF PALAM:潤滑 < PALAMLV:1
		TIMES SOURCE:痛み , 1.20
		TIMES SOURCE:反発 , 1.50
	ELSEIF PALAM:潤滑 < PALAMLV:2
		TIMES SOURCE:痛み , 0.70
		TIMES SOURCE:反発 , 1.20
	ELSEIF PALAM:潤滑 < PALAMLV:3
		TIMES SOURCE:痛み , 0.40
	ELSEIF PALAM:潤滑 < PALAMLV:4
		TIMES SOURCE:痛み , 0.10
	ELSEIF PALAM:潤滑 >= PALAMLV:4
		TIMES SOURCE:痛み , 0.10
	ENDIF
ENDIF

;特にハードなコマンドでは、異常経験に応じて効果を減らす
IF EXP:異常経験 < EXPLV:1
	TIMES SOURCE:恐れ , 1.20
	TIMES SOURCE:逸脱 , 1.20
	TIMES SOURCE:反発 , 1.20
ELSEIF EXP:異常経験 < EXPLV:2
	TIMES SOURCE:恐れ , 0.90
	TIMES SOURCE:逸脱 , 0.90
	TIMES SOURCE:反発 , 0.90
ELSEIF EXP:異常経験 < EXPLV:3
	TIMES SOURCE:恐れ , 0.80
	TIMES SOURCE:逸脱 , 0.80
	TIMES SOURCE:反発 , 0.80
ELSEIF EXP:異常経験 < EXPLV:4
	TIMES SOURCE:恐れ , 0.70
	TIMES SOURCE:逸脱 , 0.70
	TIMES SOURCE:反発 , 0.70
ELSEIF EXP:異常経験 < EXPLV:5
	TIMES SOURCE:恐れ , 0.60
	TIMES SOURCE:逸脱 , 0.60
	TIMES SOURCE:反発 , 0.60
ELSE
	TIMES SOURCE:恐れ , 0.50
	TIMES SOURCE:逸脱 , 0.50
	TIMES SOURCE:反発 , 0.50
ENDIF


;-------------------------------------------------
;経験の処理
;汚れの処理
;-------------------------------------------------
;ＡとＶ両方開いていない
IF TFLAG:705 == 4
;オトコ、又はＶに道具挿入
ELSEIF TFLAG:705 == 1
	EXP:Ａ経験 += 2
	PRINTL Ａ経験＋２
	STAIN:腸内 = 32
	STAIN:アナル = 32
ELSEIF TFLAG:705 == 0
	IF TALENT:処女 == 1 || TALENT:再生処女 == 1
		STAIN:膣内 |= 64
		STAIN:ヴァギナ |= 64
	ENDIF
	EXP:Ｖ経験 += 2
	PRINTL Ｖ経験＋２
	STAIN:膣内 = 32
	STAIN:ヴァギナ = 32
ENDIF

;獣姦初体験により異常経験
IF EXP:獣姦経験 == 0
	EXP:異常経験 += 1
	PRINTL 獣姦初経験で異常経験＋１
ENDIF
EXP:獣姦経験 += 1

;依存度ベクトル
TFLAG:33 = 5

;依存度補正値(服従で1、隷属で2）
IF TALENT:服従 && ASSIPLAY == 0
	TFLAG:30 += 1
ELSEIF TALENT:隷属 && ASSIPLAY == 0
	TFLAG:30 += 2
ENDIF

RETURN 1


