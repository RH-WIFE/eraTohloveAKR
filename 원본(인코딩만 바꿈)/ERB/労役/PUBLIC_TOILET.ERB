;====================================================================
;公衆便所プレイの処理
;奴隷を放置して不特定多数の性欲の捌け口とします
;場所によって奴隷の相手が変化し、強い存在であるほど効果と得られる金額が上がる
;安定して収入が得られる辺り、事前予約制なのかもしれない
@PUBLIC_TOILET
;====================================================================
;使用する変数の初期化
A = 0
B = 0
S = 0
V = 0
C = 0
D = 0

DRAWLINE
PRINTL 【 公衆便所プレイ 】
PRINTL 所定の位置に放置された奴隷を、公衆便所としてお使い頂けます。
PRINTL ただし基本的には、本番行為を含む「性的奉仕全般」がメインのため、
PRINTL 本来の「便器」としての役割は、追加料金となります。ご注意下さい。
PRINTL 
PRINTL ■ 基本サービス
PRINTL 　：[性的奉仕全般] [挿入] [アナルファック] [複数人プレイ]
PRINTL 
PRINTL ■ 選択されている追加オプション
PRINT 　：

SIF (FLAG:160 & 1) == 0
	FONTSTYLE 4
PRINT [処女貫通]
FONTSTYLE LOCAL:4
PRINT  

SIF (FLAG:160 & 2) == 0
	FONTSTYLE 4
PRINT [バックバージン貫通]
FONTSTYLE LOCAL:4
PRINT  

SIF (FLAG:160 & 192) == 0
	FONTSTYLE 4
PRINT [聖水プレイ]
FONTSTYLE LOCAL:4
PRINT  

SIF (FLAG:160 & 768) == 0
	FONTSTYLE 4
PRINT [黄金プレイ]
FONTSTYLE LOCAL:4

DRAWLINE


;--------------------------------------------------------
;公衆便所プレイを行う対象の選択
;--------------------------------------------------------
PRINTL 公衆便所プレイを行う奴隷を選択してください
REPEAT CHARANUM
	SIF COUNT == MASTER
		CONTINUE
	SIF CFLAG:COUNT:1 < 2
		CONTINUE
	SIF CFLAG:COUNT:12 > 0
		CONTINUE
	SIF TALENT:COUNT:受け
		CONTINUE
	SIF TALENT:COUNT:オメガ
		CONTINUE
	C = COUNT
	CALL CHECK_CHILD_CARE
	SIF RESULT == 1
		CONTINUE
	SIF CFLAG:COUNT:1 == 2 && (CFLAG:COUNT:151 & 32) && BASE:COUNT:体力 > 300
		PRINTFORML [{COUNT}] - %CALLNAME:COUNT%
REND
PRINTL [900] - オプションを選択する
PRINTL [999] - 戻る
$INPUT_LOOP
INPUT
IF RESULT == 999
	RETURN 0
ELSEIF RESULT == 900
	CALL OPTION_WORK
	CALL PUBLIC_TOILET
ELSEIF RESULT < 0 || RESULT >= CHARANUM
	GOTO INPUT_LOOP
ELSEIF RESULT == MASTER
	GOTO INPUT_LOOP
ELSEIF CFLAG:RESULT:1 < 2
	GOTO INPUT_LOOP
ELSEIF CFLAG:RESULT:12 > 0
	GOTO INPUT_LOOP
ELSEIF ((CFLAG:RESULT:151 & 32) == 0) && BASE:RESULT:体力 <= 300
	GOTO INPUT_LOOP
ELSE
	A = RESULT
ENDIF


SIF A == 0
	RETURN 0

;--------------------------------------------------------
;公衆便所プレイを行う場所の選択
;--------------------------------------------------------
PRINTL 公衆便所プレイを行う場所を選択してください
PRINTL [0]   - 裏路地
SIF BASE:A:体力 > 500
	PRINTL [1]   - 公園のトイレ
SIF BASE:A:体力 > 800
	PRINTL [2]   - 裏倶楽部
PRINTL [100] - やめる
DRAWLINE
$INPUT_LOOP2
INPUT
IF RESULT == 0
	B = 1
ELSEIF RESULT == 1 && BASE:A:体力 > 500
	B = 2
ELSEIF RESULT == 2 && BASE:A:体力 > 800
	B = 3
ELSEIF RESULT == 100
	RETURN 0
ELSE
	GOTO INPUT_LOOP2
ENDIF


;--------------------------------------------------------
;避妊具と貞操帯の選択　挿入オプションが有効の場合のみ
;--------------------------------------------------------
PRINTL 
PRINTL 避妊具／貞操帯の設定を選択してください
PRINT □ 現在の状態 … 
SIF TEQUIP:A:貞操帯
	PRINT [貞操帯装着中] 
SIF CFLAG:A:108
	PRINT [避妊結界有効] 
SIF !CFLAG:A:108 && !TEQUIP:A:貞操帯
	PRINT 避妊具は選択されていません
PRINTL 
PRINTL [ 0] - 避妊しない
PRINTL [ 1] - コンドームを着用
SIF MONEY > 2000
	PRINTL [ 2] - 避妊結界（￥-2000）
SIF ITEM:30
	PRINTL [ 3] - 貞操帯（C・V使用不可／売上DOWN↓）
PRINTL [100] - 戻る
$INPUT_LOOP_SKIN
INPUT
IF RESULT == 100
	RETURN 0
ELSEIF RESULT == 0
	J = 0
	IF TEQUIP:A:貞操帯 || CFLAG:A:108
		SIF TEQUIP:A:貞操帯
			PRINT [貞操帯]を外し
		SIF TEQUIP:A:貞操帯 && CFLAG:A:108
			PRINT 、
		SIF CFLAG:A:108
			PRINT [避妊結界]の効果を消し
		PRINTL ます
	ELSE
		PRINTL 避妊措置をせず労役を行わせます
	ENDIF
	TEQUIP:A:貞操帯 = 0
	CFLAG:A:108 = 0
	IF TALENT:A:シーメール || (!TALENT:オメガ && MALE(A))
	ELSE
		PRINTL 中出しされると妊娠をする可能性があります
	ENDIF
ELSEIF RESULT == 1 && !TALENT:A:オトコ
	J = 1
	PRINTL [コンドーム]の着用を義務付けます
ELSEIF RESULT == 2 && MONEY > 2000 && !TALENT:A:オトコ
	J = 2
	SIF TEQUIP:A:貞操帯
		PRINT [貞操帯]を外し、
	PRINTL [避妊結界]を使用します
	TEQUIP:A:貞操帯 = 0
	CFLAG:A:108 = 1
	MONEY -= 2000
ELSEIF RESULT == 3 && ITEM:30
	J = 3
	IF TEQUIP:A:貞操帯
		PRINTL [貞操帯]を装着したまま労役を行わせます
	ELSE
		PRINTL [貞操帯]を装着させます
		TEQUIP:A:貞操帯 = 1
	ENDIF
ELSE
	GOTO INPUT_LOOP_SKIN
ENDIF

;--------------------------------------------------------
;奴隷の能力、素質による倍率計算
;--------------------------------------------------------
;金額の計算
;ABLによる基礎値計算
V = 0
;ABL:従順をみる
IF ABL:A:従順 == 0
	V = 0
ELSEIF ABL:A:従順 == 1
	V = 1200
ELSEIF ABL:A:従順 == 2
	V = 1800
ELSEIF ABL:A:従順 == 3
	V = 2500
ELSEIF ABL:A:従順 == 4
	V = 3300
ELSEIF ABL:A:従順 == 5
	V = 4200
ELSEIF ABL:A:従順 == 6
	V = 5200
ELSEIF ABL:A:従順 == 7
	V = 6300
ELSEIF ABL:A:従順 == 8
	V = 7500
ELSEIF ABL:A:従順 == 9
	V = 8800
ELSE
	V = 12000
ENDIF
SIF V > 0
	PRINTFORML %ABLNAME:0%{ABL:A:従順}LV +{V}
S += V


;ABL:欲望をみる
IF ABL:A:欲望 == 0
	V = 0
ELSEIF ABL:A:欲望 == 1
	V = 1000
ELSEIF ABL:A:欲望 == 2
	V = 1500
ELSEIF ABL:A:欲望 == 3
	V = 2100
ELSEIF ABL:A:欲望 == 4
	V = 2800
ELSEIF ABL:A:欲望 == 5
	V = 3600
ELSEIF ABL:A:欲望 == 6
	V = 4500
ELSEIF ABL:A:欲望 == 7
	V = 5500
ELSEIF ABL:A:欲望 == 8
	V = 6700
ELSEIF ABL:A:欲望 == 9
	V = 8000
ELSE
	V = 10000
ENDIF
SIF V > 0
	PRINTFORML %ABLNAME:1%{ABL:A:欲望}LV +{V}
S += V


;ABL:技巧をみる
IF ABL:A:技巧 == 0
	V = 0
ELSEIF ABL:A:技巧 == 1
	V = 800
ELSEIF ABL:A:技巧 == 2
	V = 1200
ELSEIF ABL:A:技巧 == 3
	V = 1700
ELSEIF ABL:A:技巧 == 4
	V = 2300
ELSEIF ABL:A:技巧 == 5
	V = 3000
ELSEIF ABL:A:技巧 == 6
	V = 3800
ELSEIF ABL:A:技巧 == 7
	V = 4600
ELSEIF ABL:A:技巧 == 8
	V = 5500
ELSEIF ABL:A:技巧 == 9
	V = 6500
ELSE
	V = 8000
ENDIF
SIF V > 0
	PRINTFORML %ABLNAME:2%{ABL:A:技巧}LV +{V}
S += V


;ABL:Ａ感覚をみる
IF ABL:A:Ａ感覚 == 0
	V = 0
ELSEIF ABL:A:Ａ感覚 == 1
	V = 800
ELSEIF ABL:A:Ａ感覚 == 2
	V = 1200
ELSEIF ABL:A:Ａ感覚 == 3
	V = 1700
ELSEIF ABL:A:Ａ感覚 == 4
	V = 2300
ELSEIF ABL:A:Ａ感覚 == 5
	V = 3000
ELSEIF ABL:A:Ａ感覚 == 6
	V = 3800
ELSEIF ABL:A:Ａ感覚 == 7
	V = 4600
ELSEIF ABL:A:Ａ感覚 == 8
	V = 5500
ELSEIF ABL:A:Ａ感覚 == 9
	V = 6500
ELSE
	V = 8000
ENDIF
;攻めのとき、０に
SIF TALENT:A:攻め
	V = 0
SIF V > 0
	PRINTFORML %ABLNAME:5%{ABL:A:Ａ感覚}LV +{V}
S += V


;ABL:奉仕精神をみる
IF ABL:A:奉仕精神 == 0
	V = 0
ELSEIF ABL:A:奉仕精神 == 1
	V = 1200
ELSEIF ABL:A:奉仕精神 == 2
	V = 1800
ELSEIF ABL:A:奉仕精神 == 3
	V = 2500
ELSEIF ABL:A:奉仕精神 == 4
	V = 3300
ELSEIF ABL:A:奉仕精神 == 5
	V = 4200
ELSEIF ABL:A:奉仕精神 == 6
	V = 5200
ELSEIF ABL:A:奉仕精神 == 7
	V = 6300
ELSEIF ABL:A:奉仕精神 == 8
	V = 7500
ELSEIF ABL:A:奉仕精神 == 9
	V = 8800
ELSE
	V = 12000
ENDIF
SIF V > 0
	PRINTFORML %ABLNAME:7%{ABL:A:奉仕精神}LV +{V}
S += V


;ABL:露出癖をみる
IF ABL:A:露出癖 == 0
	V = 0
ELSEIF ABL:A:露出癖 == 1
	V = 800
ELSEIF ABL:A:露出癖 == 2
	V = 1200
ELSEIF ABL:A:露出癖 == 3
	V = 1700
ELSEIF ABL:A:露出癖 == 4
	V = 2300
ELSEIF ABL:A:露出癖 == 5
	V = 3000
ELSEIF ABL:A:露出癖 == 6
	V = 3800
ELSEIF ABL:A:露出癖 == 7
	V = 4600
ELSEIF ABL:A:露出癖 == 8
	V = 5500
ELSEIF ABL:A:露出癖 == 9
	V = 6500
ELSE
	V = 8000
ENDIF
SIF V > 0
	PRINTFORML %ABLNAME:8%{ABL:A:露出癖}LV +{V}
S += V


;ABL:マゾっ気をみる
IF ABL:A:マゾっ気 == 0
	V = 0
ELSEIF ABL:A:マゾっ気 == 1
	V = 1000
ELSEIF ABL:A:マゾっ気 == 2
	V = 1500
ELSEIF ABL:A:マゾっ気 == 3
	V = 2100
ELSEIF ABL:A:マゾっ気 == 4
	V = 2800
ELSEIF ABL:A:マゾっ気 == 5
	V = 3600
ELSEIF ABL:A:マゾっ気 == 6
	V = 4500
ELSEIF ABL:A:マゾっ気 == 7
	V = 5500
ELSEIF ABL:A:マゾっ気 == 8
	V = 6700
ELSEIF ABL:A:マゾっ気 == 9
	V = 8000
ELSE
	V = 10000
ENDIF
SIF V > 0
	PRINTFORML %ABLNAME:9%{ABL:A:マゾっ気}LV +{V}
S += V


;ABL:精液中毒をみる
IF ABL:A:精液中毒 == 0
	V = 0
ELSEIF ABL:A:精液中毒 == 1
	V = 1500
ELSEIF ABL:A:精液中毒 == 2
	V = 2200
ELSEIF ABL:A:精液中毒 == 3
	V = 3000
ELSEIF ABL:A:精液中毒 == 4
	V = 3900
ELSEIF ABL:A:精液中毒 == 5
	V = 4900
ELSEIF ABL:A:精液中毒 == 6
	V = 6000
ELSEIF ABL:A:精液中毒 == 7
	V = 7200
ELSEIF ABL:A:精液中毒 == 8
	V = 8500
ELSEIF ABL:A:精液中毒 == 9
	V = 10000
ELSE
	V = 14000
ENDIF
SIF V > 0
	PRINTFORML %ABLNAME:16%{ABL:A:精液中毒}LV +{V}
S += V


;ABL:セックス中毒をみる
IF ABL:A:セックス中毒 == 0
	V = 0
ELSEIF ABL:A:セックス中毒 == 1
	V = 1500
ELSEIF ABL:A:セックス中毒 == 2
	V = 2200
ELSEIF ABL:A:セックス中毒 == 3
	V = 3000
ELSEIF ABL:A:セックス中毒 == 4
	V = 3900
ELSEIF ABL:A:セックス中毒 == 5
	V = 4900
ELSEIF ABL:A:セックス中毒 == 6
	V = 6000
ELSEIF ABL:A:セックス中毒 == 7
	V = 7200
ELSEIF ABL:A:セックス中毒 == 8
	V = 8500
ELSEIF ABL:A:セックス中毒 == 9
	V = 10000
ELSE
	V = 14000
ENDIF
SIF V > 0
	PRINTFORML %ABLNAME:18%{ABL:A:セックス中毒}LV +{V}
S += V


;--------------------------------------------------------
;奴隷の素質を計算
;--------------------------------------------------------
V = 100
;素質による売却額補正値計算
;TALENT:処女をみる
IF TALENT:A:処女
	C = 100
	V += 100
	PRINTFORML %TALENTNAME:0% ＋{C}％
ENDIF
;TALENT:再生処女をみる
IF TALENT:A:再生処女
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:1% ＋{C}％
ENDIF
;TALENT:バックバージンをみる
IF TALENT:A:バックバージン
	C = 100
	V += 100
	PRINTFORML %TALENTNAME:161% ＋{C}％
ENDIF
;素質による増減
;陥落素質
;恋慕
IF TALENT:A:恋慕
	C = 50
	V -= 50
	PRINTFORML %TALENTNAME:3% －{C}％
ENDIF
;淫乱
IF TALENT:A:淫乱
	C = 50
	V += 50
	PRINTFORML %TALENTNAME:4% ＋{C}％
ENDIF
;服従
IF TALENT:A:服従
	C = 50
	V += 50
	PRINTFORML %TALENTNAME:5% ＋{C}％
ENDIF
;親愛
IF TALENT:A:親愛
	C = 100
	V -= 100
	PRINTFORML %TALENTNAME:6% －{C}％
ENDIF
;娼婦
IF TALENT:A:娼婦
	C = 80
	V += 80
	PRINTFORML %TALENTNAME:7% ＋{C}％
ENDIF
;隷属
IF TALENT:A:隷属
	C = 100
	V += 100
	PRINTFORML %TALENTNAME:8% ＋{C}％
ENDIF



;その他素質
;臆病
IF TALENT:A:臆病
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:10% －{C}％
ENDIF
;反抗的
IF TALENT:A:反抗的
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:11% ＋{C}％
ENDIF
;気丈
IF TALENT:A:気丈
	C = 40
	V += 40
	PRINTFORML %TALENTNAME:12% ＋{C}％
ENDIF
;素直
IF TALENT:A:素直
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:13% －{C}％
ENDIF
;大人しい
IF TALENT:A:大人しい
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:14% －{C}％
ENDIF
;プライド高い
IF TALENT:A:プライド高い
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:15% ＋{C}％
ENDIF
;生意気
IF TALENT:A:生意気
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:16% ＋{C}％
ENDIF
;プライド低い
IF TALENT:A:プライド低い
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:17% －{C}％
ENDIF
;ツンデレ
IF TALENT:A:ツンデレ
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:18% ＋{C}％
ENDIF
;自制心
IF TALENT:A:自制心
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:20% ＋{C}％
ENDIF
;無関心
IF TALENT:A:無関心
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:21% －{C}％
ENDIF
;感情乏しい
IF TALENT:A:感情乏しい
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:22% －{C}％
ENDIF
;好奇心
IF TALENT:A:好奇心
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:23% ＋{C}％
ENDIF
;保守的
IF TALENT:A:保守的
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:24% ＋{C}％
ENDIF
;一線越えない
IF TALENT:A:一線越えない
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:27% ＋{C}％
ENDIF
;目立ちたがり
IF TALENT:A:目立ちたがり
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:28% ＋{C}％
ENDIF
;貞操観念
IF TALENT:A:貞操観念
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:30% ＋{C}％
ENDIF
;貞操無頓着
IF TALENT:A:貞操無頓着
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:31% －{C}％
ENDIF
;解放
IF TALENT:A:解放
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:33% ＋{C}％
ENDIF
;恥じらい
IF TALENT:A:恥じらい
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:35% ＋{C}％
ENDIF
;恥薄い
IF TALENT:A:恥薄い
	C = 10
	V -= 10
	PRINTFORML %TALENTNAME:36% －{C}％
ENDIF
;痛みに弱い
IF TALENT:A:痛みに弱い
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:40% －{C}％
ENDIF
;痛みに強い
IF TALENT:A:痛みに強い
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:41% ＋{C}％
ENDIF
;濡れやすい
IF TALENT:A:濡れやすい
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:42% ＋{C}％
ENDIF
;濡れにくい
IF TALENT:A:濡れにくい
	C = 10
	V -= 10
	PRINTFORML %TALENTNAME:43% －{C}％
ENDIF
;習得早い
IF TALENT:A:習得早い
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:50% ＋{C}％
ENDIF
;習得遅い
IF TALENT:A:習得遅い
	C = 10
	V -= 10
	PRINTFORML %TALENTNAME:51% －{C}％
ENDIF
;舌使い
IF TALENT:A:舌使い
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:52% ＋{C}％
ENDIF
;薬毒耐性
IF TALENT:A:薬毒耐性
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:56% －{C}％
ENDIF
;おもらし癖
IF TALENT:A:おもらし癖
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:57% ＋{C}％
ENDIF
;自慰しやすい
IF TALENT:A:自慰しやすい
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:60% ＋{C}％
ENDIF
;汚臭鈍感
IF TALENT:A:汚臭鈍感
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:61% －{C}％
ENDIF
;汚臭敏感
IF TALENT:A:汚臭敏感
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:62% ＋{C}％
ENDIF
;献身的
IF TALENT:A:献身的
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:63% ＋{C}％
ENDIF
;汚れ無視
IF TALENT:A:汚れ無視
	C = 30
	V -= 30
	PRINTFORML %TALENTNAME:64% －{C}％
ENDIF
;快感に素直
IF TALENT:A:快感に素直
	C = 30
	V -= 30
	PRINTFORML %TALENTNAME:70% －{C}％
ENDIF
;快感の否定
IF TALENT:A:快感の否定
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:71% ＋{C}％
ENDIF
;即落ち
IF TALENT:A:即落ち
	C = 50
	V -= 50
	PRINTFORML %TALENTNAME:73% －{C}％
ENDIF
;自慰狂い
IF TALENT:A:自慰狂い
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:74% ＋{C}％
ENDIF
;淫壺
IF TALENT:A:淫壺
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:75% ＋{C}％
ENDIF
;尻穴狂い
IF TALENT:A:尻穴狂い
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:76% ＋{C}％
ENDIF
;淫乳
IF TALENT:A:淫乳
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:77% ＋{C}％
ENDIF
;セックス狂
IF TALENT:A:セックス狂
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:78% ＋{C}％
ENDIF
;倒錯的
IF TALENT:A:倒錯的
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:80% ＋{C}％
ENDIF
;男嫌い
IF TALENT:A:男嫌い
	C = 10
	V -= 10
	PRINTFORML %TALENTNAME:82% －{C}％
ENDIF
;サド
IF TALENT:A:サド
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:83% ＋{C}％
ENDIF
;マゾ
IF TALENT:A:マゾ
	C = 40
	V += 40
	PRINTFORML %TALENTNAME:84% ＋{C}％
ENDIF
;妄信
IF TALENT:A:妄信
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:86% ＋{C}％
ENDIF
;小悪魔
IF TALENT:A:小悪魔
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:87% ＋{C}％
ENDIF
;女嫌い
IF TALENT:A:女嫌い
	C = 10
	V -= 10
	PRINTFORML %TALENTNAME:88% －{C}％
ENDIF
;妖狐
IF TALENT:A:妖狐
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:91% ＋{C}％
ENDIF
;魅力
IF TALENT:A:魅力
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:92% ＋{C}％
ENDIF
;謎の魅力
IF TALENT:A:謎の魅力
	C = 100
	V += 100
	PRINTFORML %TALENTNAME:94% ＋{C}％
ENDIF
;Ｃ鈍感（感覚が4以上なら無効）
IF TALENT:A:Ｃ鈍感 && ABL:A:Ｃ感覚 < 4
	C = 30
	V -= 30
	PRINTFORML %TALENTNAME:101% －{C}％
ENDIF
;Ｃ敏感（感覚が3未満なら無効）
IF TALENT:A:Ｃ敏感 && ABL:A:Ｃ感覚 >= 3
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:102% ＋{C}％
ENDIF
;Ｖ鈍感（感覚が4以上なら無効）
IF TALENT:A:Ｖ鈍感 && ABL:A:Ｖ感覚 < 4
	C = 30
	V -= 30
	PRINTFORML %TALENTNAME:103% －{C}％
ENDIF
;Ｖ敏感（感覚が3未満なら無効）
IF TALENT:A:Ｖ敏感 && ABL:A:Ｖ感覚 >= 3
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:104% ＋{C}％
ENDIF
;Ａ鈍感（感覚が4以上なら無効）
IF TALENT:A:Ａ鈍感 && ABL:A:Ａ感覚 < 4
	C = 30
	V -= 30
	PRINTFORML %TALENTNAME:105% －{C}％
ENDIF
;Ａ敏感（感覚が3未満なら無効）
IF TALENT:A:Ａ敏感 && ABL:A:Ａ感覚 >= 3
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:106% ＋{C}％
ENDIF
;Ｂ鈍感（感覚が4以上なら無効）
IF TALENT:A:Ｂ鈍感 && ABL:A:Ｂ感覚 < 4
	C = 30
	V -= 30
	PRINTFORML %TALENTNAME:107% －{C}％
ENDIF
;Ｂ敏感（感覚が3未満なら無効）
IF TALENT:A:Ｂ敏感 && ABL:A:Ｂ感覚 >= 3
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:108% ＋{C}％
ENDIF
;貧乳
IF TALENT:A:貧乳
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:109% －{C}％
ENDIF
;絶壁
IF TALENT:A:絶壁
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:110% ＋{C}％
ENDIF
;巨乳
IF TALENT:A:巨乳
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:111% ＋{C}％
ENDIF
;爆乳
IF TALENT:A:爆乳
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:112% ＋{C}％
ENDIF
;陥没乳首
IF TALENT:A:陥没乳首
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:120% ＋{F}％
ENDIF
;回復早い
IF TALENT:A:回復早い
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:130% ＋{C}％
ENDIF
;回復遅い
IF TALENT:A:回復遅い
	C = 20
	V -= 20
	PRINTFORML %TALENTNAME:131% －{C}％
ENDIF
;吸血鬼
IF TALENT:A:吸血鬼
	C = 30
	V += 30
	PRINTFORML %TALENTNAME:132% ＋{C}％
ENDIF
;動物耳
IF TALENT:A:動物耳
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:143% ＋{C}％
ENDIF
;人気
IF TALENT:A:人気
	C = 50
	V += 50
	PRINTFORML %TALENTNAME:145% ＋{C}％
ENDIF
;不死身
IF TALENT:A:不死身
	C = 70
	V += 70
	PRINTFORML %TALENTNAME:147% ＋{C}％
ENDIF
;母乳体質
IF TALENT:A:母乳体質
	C = 20
	V += 20
	PRINTFORML %TALENTNAME:149% ＋{C}％
ENDIF
;発情期
IF TALENT:A:発情期
	C = 10
	V += 10
	PRINTFORML %TALENTNAME:171% ＋{C}％
ENDIF
;極
IF TALENT:A:極
	C = 50
	V -= 50
	PRINTFORML %TALENTNAME:180% ＋{C}％
ENDIF


;補正値が0以下の場合は1にする
SIF V < 0
	V = 1

PRINTFORML 最終倍率 {V}％

;補正値の適用
S *= V
S /= 100


;崩壊,狂気,妊娠は報酬をかなり低くする（従順によって、80％まで回復）
IF TALENT:A:崩壊 || TALENT:A:狂気 || TALENT:A:妊娠
PRINTL 
	IF TALENT:A:崩壊
		S *= ABL:A:従順
		TIMES S , 0.08
		Z = ABL:A:従順
		Z *= 8
		PRINTFORML %TALENTNAME:9% ×{Z}％
	ELSEIF TALENT:A:狂気
		S *= ABL:A:従順
		TIMES S , 0.08
		Z = ABL:A:従順
		Z *= 8
		PRINTFORML %TALENTNAME:141% ×{Z}％
	ELSEIF TALENT:A:妊娠
		S *= ABL:A:従順
		TIMES S , 0.08
		Z = ABL:A:従順
		Z *= 8
		PRINTFORML %TALENTNAME:153% ×{Z}％
	ENDIF
PRINTL 
ENDIF

;難易度処理
;EASY
IF FLAG:4 == 1
	PRINTFORML 難易度:EASY ×120％
	TIMES S , 1.20
;NORMAL
ELSEIF FLAG:4 == 2
	TIMES S , 1.00
;HARD
ELSEIF FLAG:4 == 3
	PRINTFORML 難易度:HARD ×80％
	TIMES S , 0.80
ENDIF

;コンドームの場合はペナルティ補正がかかる
SIF J == 1
	TIMES S , 0.80

;貞操帯ついてる場合ペナルティ
SIF J == 3
	TIMES S , 0.60

;場所による補正
IF B == 1
	TIMES S , 0.80
ELSEIF B == 2
	TIMES S , 1.00
ELSEIF B == 3
	TIMES S , 1.20
ENDIF




;公衆便所プレイを実行するか？
IF S > 0
	PRINTFORML 利益は{S}朱程度が見込めます
ELSE
	PRINTFORMW 利益が見込めないので、中止します
	RETURN 0
ENDIF
PRINTFORML %CALLNAME:A%で公衆便所プレイを行いますか？
PRINTL [0]   - 実行する
PRINTL [100] - やめる
$INPUT_LOOP_4
INPUT
IF RESULT == 100
	RETURN 0
ELSEIF RESULT != 0
	GOTO INPUT_LOOP_4
ENDIF


;--------------------------------------------------------
;実行処理
;--------------------------------------------------------
PRINTFORML %CALLNAME:A%で公衆便所プレイを実行しました

;プレイ内容の判定
CALL TOILET_PLAY_CHECK

;イベント口上の表示
U = 0
IF ASSI >= 0
	SIF ASSI == A
		U = 1
ENDIF
T = TARGET
TARGET = A
TFLAG:13 = 22
CALL KOJO_MESSAGE_EVENT
TARGET = T
SIF U
	ASSI = A


;--------------------------------------------------------
;経験の加算処理と表示
;--------------------------------------------------------
PRINTFORML 
PRINTFORML 【%CALLNAME:A%の経験と珠】


;--------------------------------------------------------
;輪姦経験
;--------------------------------------------------------
IF CFLAG:A:161
	IF EXP:A:輪姦経験 == 0
		PRINTFORML 輪姦初経験で異常経験＋１
		EXP:A:異常経験 += 1
	ENDIF
	EXP:A:輪姦経験 += CFLAG:A:161
	PRINTFORML 輪姦経験＋{CFLAG:A:161}
ENDIF

;--------------------------------------------------------
;性的奉仕全般
C = 0
Q = 0
;--------------------------------------------------------
IF CFLAG:A:160
	C = (CFLAG:A:160+ABL:A:奉仕精神+ABL:A:技巧+ABL:A:精液中毒)/3
	
	EXP:A:精液経験 += C/2
	PRINTFORML %EXPNAME:20%＋{C/2}
	
	EXP:A:フェラ経験 += C/3
	PRINTFORML %EXPNAME:22%＋{C/3}
	
	;習得の珠用
	Q += C
ENDIF

;--------------------------------------------------------
;性交系
;挿入		CFLAG:A:162
;ＡＦ		CFLAG:A:164
D = 0
E = 0
F = 0
V = 0
L = 0
;--------------------------------------------------------
IF CFLAG:A:162 || CFLAG:A:164
	;発情期なら確実に１回は性交する
	SIF CFLAG:A:162
		E = (CFLAG:A:162+ABL:A:Ｖ感覚+ABL:A:欲望)/3 + TALENT:A:発情期
	SIF CFLAG:A:164
		F = (CFLAG:A:164+ABL:A:Ａ感覚+ABL:A:欲望)/3 + TALENT:A:発情期
	
	;性交経験と膣射経験
	IF E > 0 || F > 0
		EXP:A:性交経験 += E+F
		PRINTFORML %EXPNAME:4%＋{E+F}
		
		;Ｖ性交してれば膣射経験
		IF E > 0 && (CFLAG:A:108 == 0 || TEQUIP:A:貞操帯 == 0)
			EXP:A:膣射経験 += E/2
			;娼館などの客と奴隷間の中田氏カウント用
			CFLAG:A:105 += E/2
			PRINTFORML %EXPNAME:5%＋{E/2}
		ENDIF
		;Ａ性交してれば腸射経験
		IF F > 0 && CFLAG:A:108 == 0
			EXP:A:腸射経験 += F/2
			;娼館などの客と奴隷間の腸中田氏カウント用
			CFLAG:A:705 += F/2
			PRINTFORML %EXPNAME:14%＋{F/2}
		ENDIF
	ENDIF
	
	;貫通系
	IF E > 0
		IF TALENT:A:処女 && CFLAG:A:163
			PRINTFORML 公衆便所プレイで処女喪失
			PRINTFORML 異常経験＋１
			EXP:A:異常経験 += 1
			TALENT:A:処女 = 0
			CSTR:A:10 = 公衆便所プレイ
			
			;苦痛の珠用
			D += 10
		ELSEIF TALENT:A:再生処女 && CFLAG:A:163
			PRINTFORML 公衆便所プレイで再生処女喪失
			TALENT:A:再生処女 = 0
			
			;苦痛の珠用
			D += 5
		ENDIF
	ENDIF
	IF F > 0
		IF TALENT:A:バックバージン && CFLAG:A:165
			PRINTFORML 公衆便所プレイでバックバージン喪失
			PRINTFORML %EXPNAME:50%＋１
			EXP:A:異常経験 += 1
			TALENT:A:バックバージン = 0
			CSTR:A:12 = 公衆便所プレイ
			
			;苦痛の珠用
			D += 10
		ENDIF
		
		;苦痛の珠用
		D += F/3
	ENDIF
	
	;不快の珠
	SIF TALENT:A:恋慕
		L += (E+F)*2
	SIF TALENT:A:親愛
		L += (E+F)*3
	
	;V = 絶頂回数保存
	V += (E+F)/2
ENDIF


;--------------------------------------------------------
;絶頂経験、射精経験
;--------------------------------------------------------
IF V > 0
	EXP:A:絶頂経験 += V
	PRINTFORML 絶頂経験＋{V}
	
	IF PENIS(A)
		IF TALENT:A:子供サイズ
			EXP:A:空射精経験 += V
			PRINTFORML 空射精経験＋{V}
		ELSEIF TEQUIP:A:貞操帯
			EXP:A:射精経験 += V/2
			PRINTFORML 射精経験＋{V/2}
		ELSE
			EXP:A:射精経験 += V
			PRINTFORML 射精経験＋{V}
		ENDIF
	ENDIF
ENDIF


;--------------------------------------------------------
;スカ行為判定
;飲尿		CFLAG:A:166
;体内放尿	CFLAG:A:167
G = 0
D = 0
;--------------------------------------------------------
IF CFLAG:A:166 || CFLAG:A:167
	;体内放尿回数
	G = CFLAG:A:167
	;飲尿回数
	U = CFLAG:A:166
	
	IF EXP:A:スカ経験 == 0
		PRINTFORML スカ初経験で異常経験＋１
		EXP:A:異常経験 += 1
	ENDIF
	IF U+G > 0
		EXP:A:スカ経験 += U+G
		PRINTFORML スカ経験＋{U+G}
	ENDIF
	IF U > 0
		EXP:A:飲尿経験 += U
		PRINTFORML 飲尿経験＋{U}
	ENDIF
	IF G > 0
		EXP:A:体内放尿経験 += G
		PRINTFORML 体内放尿経験＋{G}
		EXP:A:浣腸経験 += G
		PRINTFORML 浣腸経験＋{G}
		EXP:A:排便経験 += G
		PRINTFORML 排便経験＋{G}
	ENDIF
	
	;苦痛の珠用
	SIF G > 0
		D += G*2
	
	;不快の珠
	L += (10-ABL:A:スカ中毒)*2
ENDIF

;--------------------------------------------------------
;珠表示
;--------------------------------------------------------
IF E > 0
	JUEL:A:快Ｖ += E*50
	PRINTFORML %PALAMNAME:1%の珠＋{E*50}
ENDIF
IF F > 0
	JUEL:A:快Ａ += F*50
	PRINTFORML %PALAMNAME:2%の珠＋{F*50}
ENDIF

JUEL:A:恭順 += X*100
PRINTFORML 恭順の珠＋{X*100}

JUEL:A:欲情 += V*30
PRINTFORML 欲情の珠＋{V*30}

JUEL:A:習得 += Q*30
PRINTFORML 習得の珠＋{Q*30}

JUEL:A:苦痛 += D*50
PRINTFORML 苦痛の珠＋{D*50}

JUEL:A:恐怖 += X*50
PRINTFORML 恐怖の珠＋{X*50}

JUEL:A:不快 += L*50
PRINTFORML 不快の珠＋{L*50}

JUEL:A:否定 += ((D+X+L)*100)/ABL:A:従順
PRINTFORML %PALAMNAME:100%の珠＋{((D+X+L)*100)/ABL:A:従順}


;--------------------------------------------------------
;体力の減少、ストレス、禁欲ポイント
;--------------------------------------------------------
BASE:A:体力 -= B*500

;禁欲ポイント
IF TEQUIP:A:貞操帯
	CFLAG:A:602 += X
	SIF TALENT:MASTER:千里眼
		PRINTFORML 禁欲ポイント＋{X}
ELSE
	CFLAG:A:602 = 0
ENDIF

;ストレス値の付加
CFLAG:A:10 += B*5
SIF TALENT:MASTER:千里眼
	PRINTFORML 疲労度＋{B*5}



;--------------------------------------------------------
;金額の計算
;--------------------------------------------------------
IF B == 1
	S += X*100
ELSEIF B == 2
	S += X*500
ELSE
	S += X*1000
ENDIF

;最後に金額の加算
PRINTFORMW %CALLNAME:A%での公衆便所プレイで{S}朱を得ました
MONEY += S

;休憩フラグを立てる
FLAG:0 = 1
BEGIN TURNEND

RETURN 1



@TOILET_PLAY_CHECK
;--------------------------------------------------------
;人数とプレイ内容の計算
;最大人数30人
IF B == 1
	LOCAL = RAND:20+1
ELSEIF B == 2
	LOCAL = RAND:15+1
ELSE
	LOCAL = RAND:10+1
ENDIF
LOCAL = 10+LOCAL
X = 0

;性的奉仕	CFLAG:A:160
;複数人		CFLAG:A:161
;挿入		CFLAG:A:162
;処女		CFLAG:A:163
;ＡＦ		CFLAG:A:164
;Ａ処女		CFLAG:A:165
;飲尿		CFLAG:A:166
;体内放尿	CFLAG:A:167

CFLAG:A:160 = 0
CFLAG:A:161 = 0
CFLAG:A:162 = 0
CFLAG:A:163 = 0
CFLAG:A:164 = 0
CFLAG:A:165 = 0
CFLAG:A:166 = 0
CFLAG:A:167 = 0
;--------------------------------------------------------
REPEAT 30
	;最大人数超えたら抜ける
	IF X == LOCAL
		BREAK
	;なんもなければ客を選出
	ELSE
		;-----------------------
		;人数を増やす
		;-----------------------
		X += 1
		
		C = 10-ABL:A:スカ中毒
		;飲尿
		LOCAL:1 = 0
		;体内放尿
		LOCAL:2 = 0
		;放尿目当てかどうか判定
		IF (FLAG:160 & 128 || FLAG:160 & 768) && RAND:C == 0
			;飲ませようとする
			IF FLAG:160 & 128 && (FLAG:160 & 768) == 0
				;飲ませる
				LOCAL:1 = 1
			;体内放尿しようとする
			ELSEIF FLAG:160 & 768 && (FLAG:160 & 128) == 0
				;Ａ本番不可（奴隷処女でオプションがない、もしくは奴隷が攻め）
				IF (TALENT:A:バックバージン && (FLAG:160 & 2) == 0) || TALENT:A:攻め
					;飲ませる
					LOCAL:1 = 1
				ELSE
					;体内放尿
					LOCAL:2 = 1
				ENDIF
			ELSE
				;Ａ本番不可（奴隷処女でオプションがない、もしくはランダム1/3、もしくは奴隷が攻め）
				IF (TALENT:A:バックバージン && (FLAG:160 & 2) == 0) || RAND:2 == 0 || TALENT:A:攻め
					;飲ませる
					LOCAL:1 = 1
				ELSE
					;体内放尿
					LOCAL:2 = 1
				ENDIF
			ENDIF
		ENDIF
		
		;体内放尿目的の客
		IF LOCAL:2
			CFLAG:A:167 += 1
			;Ａセックス回数も増える
			CFLAG:A:164 += 1
			SIF TALENT:A:バックバージン && (FLAG:160 & 2)
				CFLAG:A:165 += 1
		;飲ませる目的の客
		ELSEIF LOCAL:1
			CFLAG:A:166 += 1
		ENDIF
		
		;1/5の確率で、以降何もせず帰る
		SIF (LOCAL:2 || LOCAL:1) && RAND:4 == 0
			CONTINUE
		
		;奉仕
		LOCAL:3 = 0
		;Ｖ本番
		LOCAL:4 = 0
		;Ａ本番
		LOCAL:5 = 0
		;本番目当てかどうか判定
		;奴隷が攻めだと挿入できない
		IF TALENT:A:攻め
			LOCAL:3 = 1
		;ＶがないとＡしか狙えない
		ELSEIF !VAGINA(A)
			;奴隷Ａ処女でオプションがないとＡも狙えない
			;1/5の確率でＡに興味を示さない
			IF (TALENT:A:バックバージン && (FLAG:160 & 2) == 0) || RAND:4 == 0
				LOCAL:3 = 1
			ELSE
				LOCAL:5 = 1
			ENDIF
		;Ｖを狙う
		ELSE
			;奴隷処女でオプションがないと本番できない
			;1/5の確率でＶに興味を示さない
			IF ((TALENT:A:処女 || TALENT:A:再生処女) && (FLAG:160 & 1) == 0) || RAND:4 == 0
				LOCAL:3 = 1
			ELSE
				LOCAL:4 = 1
			ENDIF
		ENDIF
		
		;何もさせてない客がいた場合、奉仕フラグを立てる
		SIF !LOCAL:1 && !LOCAL:2 && !LOCAL:3 && !LOCAL:4 && !LOCAL:5
			LOCAL:3 = 1
		
		;Ｖ本番
		IF LOCAL:4
			CFLAG:A:162 += 1
			SIF (TALENT:A:処女 || TALENT:A:再生処女) && (FLAG:160 & 1)
				CFLAG:A:163 += 1
		ENDIF
		
		;Ａ本番
		IF LOCAL:5
			CFLAG:A:164 += 1
			SIF TALENT:A:バックバージン && (FLAG:160 & 2)
				CFLAG:A:165 += 1
		ENDIF
		
		;奉仕
		IF LOCAL:3
			CFLAG:A:160 += 1
		ENDIF
	ENDIF
REND

;人数確定後、数プレイ判定をつける
CFLAG:A:161 += (X/10)+1



