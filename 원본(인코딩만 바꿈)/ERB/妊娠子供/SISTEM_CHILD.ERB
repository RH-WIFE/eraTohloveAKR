;=============================================================================
;子供パッチの諸処理
;=============================================================================
;-------------------------------------------------
;子供誕生判定処理
;引数０は母親、引数１は父親、引数２は乳母
;-------------------------------------------------
@CHILD_CHECK(ARG:0, ARG:1, ARG:2)
PRINTL 
;子供を追加
LOCAL = 0
LOCAL:1 = 0
$SELECTER
IF !LOCAL || LOCAL == 890
	LOCAL = 890 + RAND:10
ELSE
	LOCAL--
ENDIF
FOR LOCAL:2, 1, CHARANUM
	SIF LOCAL == NO:(LOCAL:2)
		LOCAL:1 = 1
NEXT
SIF LOCAL:1
	GOTO SELECTER
ADDCHARA LOCAL
LOCAL = CHARANUM-1
CALL CHILD_PLUS(LOCAL, ARG:0, ARG:1, ARG:2)

@CHILD_PLUS(ARG:0, ARG:1, ARG:2, ARG:3)
;父親と母親に子供の数＋
CFLAG:(ARG:1):112 += 1
SIF ARG:2 > -1
	CFLAG:(ARG:2):113 += 1

;子育て中の実子の固有番号:育児放棄の場合は乳母に入れる
SIF !ARG:3
	CFLAG:(ARG:1):114 = NO:ARG
;子供に、育ててもらう母or養母の固有番号を入れる
CFLAG:ARG:115 = NO:(ARG:1)
SIF ARG:3
	CFLAG:ARG:115 = NO:(ARG:3)
;成長フラグを入れる
CFLAG:ARG:116 = DAY

;子供に父親と母親のキャラ番号/名前を入れる
CFLAG:(ARG:0):1001 = NO:(ARG:1)
CSTR:(ARG:0):3 = %CALLNAME:(ARG:1)%
STRLENS CSTR:(ARG:1):2
IF RESULT
	CFLAG:ARG:1004 = CFLAG:(ARG:1):1000
	CSTR:ARG:6 = %CSTR:(ARG:1):2%
ELSE
	CFLAG:ARG:1004 = -1
ENDIF
STRLENS CSTR:(ARG:1):3
IF RESULT
	CFLAG:ARG:1005 = CFLAG:(ARG:1):1001
	CSTR:ARG:7 = %CSTR:(ARG:1):3%
ELSE
	CFLAG:ARG:1005 = -1
ENDIF
IF ARG:2 > -1
	CFLAG:(ARG:0):1000 = NO:(ARG:2)
	CSTR:(ARG:0):2 = %CALLNAME:(ARG:2)%
	STRLENS CSTR:(ARG:2):2
	IF RESULT
		CFLAG:ARG:1002 = CFLAG:(ARG:2):1000
		CSTR:ARG:4 = %CSTR:(ARG:2):2%
	ELSE
		CFLAG:ARG:1002 = -1
	ENDIF
	STRLENS CSTR:(ARG:2):3
	IF RESULT
		CFLAG:ARG:1003 = CFLAG:(ARG:2):1001
		CSTR:ARG:5 = %CSTR:(ARG:2):3%
	ELSE
		CFLAG:ARG:1003 = -1
	ENDIF
ENDIF

;性別
IF ARG:1 == MASTER || ARG:2 == MASTER
	LOCALS:1 = 娘
ELSE
	LOCALS:1 = 女の子
ENDIF
IF !RAND:250
	TALENT:(ARG):ふたなり = 1
	IF ARG:1 == MASTER || ARG:2 == MASTER
		LOCALS:1 = 娘
	ELSE
		LOCALS:1 = 女の子
	ENDIF
ELSEIF !RAND:249
	TALENT:(ARG):半陰半陽 = 1
	IF ARG:1 == MASTER || ARG:2 == MASTER
		LOCALS:1 = 息子
	ELSE
		LOCALS:1 = 男の子
	ENDIF
ELSEIF !RAND:248
	TALENT:(ARG):カントボーイ = 1
	IF ARG:1 == MASTER || ARG:2 == MASTER
		LOCALS:1 = 息子
	ELSE
		LOCALS:1 = 男の子
	ENDIF
ELSEIF !RAND:247
	TALENT:(ARG):シーメール = 1
	IF ARG:1 == MASTER || ARG:2 == MASTER
		LOCALS:1 = 娘
	ELSE
		LOCALS:1 = 女の子
	ENDIF
ELSEIF !RAND:2
	TALENT:(ARG):オトコ = 1
	IF ARG:1 == MASTER || ARG:2 == MASTER
		LOCALS:1 = 息子
	ELSE
		LOCALS:1 = 男の子
	ENDIF
ENDIF

;気力体力の処理
MAXBASE:(ARG):体力 = MAXBASE:(ARG:1):体力 / 120 * 100
SIF MAXBASE:(ARG):体力 < 1100
	MAXBASE:(ARG):体力 = 1000
MAXBASE:(ARG):気力 = MAXBASE:(ARG:1):気力 / 60 * 50
SIF MAXBASE:(ARG):気力 < 550
	MAXBASE:(ARG):気力 = 500
BASE:(ARG):体力 = MAXBASE:(ARG):体力
BASE:(ARG):気力 = MAXBASE:(ARG):気力

;従順の処理、産みの親の反発刻印が少ないほど最初から従順
ABL:(ARG):従順 = 3 - MARK:(ARG:1):反発刻印
SIF ABL:(ARG):従順 < 0
	ABL:(ARG):従順 = 0

;遺伝の処理
;↓最初からついてるもの
;処女/童貞/後処女
REPEAT 180
	SIF COUNT < 10 || (COUNT >= 74 && COUNT <= 78) || COUNT == 85 || COUNT == 137 || COUNT == 139 || COUNT == 140 || COUNT == 149 || (COUNT >= 153 && COUNT <= 155) || (COUNT >= 157 && COUNT <= 159) || COUNT == 162 || COUNT == 165
		CONTINUE
	IF RAND:5 > 1 && ARG:2 > -1 && TALENT:(ARG:2):COUNT
		TALENT:(ARG):COUNT = 1
	ELSEIF RAND:5 > 1 && TALENT:(ARG:1):COUNT
		TALENT:(ARG):COUNT = 1
	ELSEIF !RAND:10 && (COUNT == 92 || COUNT == 93 || COUNT == 94 || (COUNT >= 101 && COUNT <= 108))
		TALENT:ARG:COUNT = 1
	ELSE
		TALENT:ARG:COUNT = 0
	ENDIF
REND

CALL CHILD_TALENT_SET(ARG)

;相性決定
FOR LOCAL, 0, 500
	IF RELATION:(ARG:1):LOCAL > 100 || (RELATION:(ARG:1):LOCAL < 100 && RELATION:(ARG:1):LOCAL != 0)
		RELATION:ARG:LOCAL = (RELATION:(ARG:1):LOCAL) / 2 + 50
		SIF RELATION:ARG:LOCAL > 200
			RELATION:ARG:LOCAL = 200
	ENDIF
NEXT

;親との相性良し
RELATION:ARG:(NO:(ARG:1)) = 200
RELATION:(ARG:1):(NO:ARG) = 200
IF ARG:2 > -1
	RELATION:ARG:(NO:(ARG:2)) = 200
	RELATION:(ARG:2):(NO:ARG) = 150
ENDIF
IF ARG:3
	RELATION:ARG:(NO:(ARG:3)) = 200
	RELATION:(ARG:3):(NO:ARG) = 150
ENDIF

;母親が主人で父親が居るか、乳母にまかされていない
;IF ARG:1 == MASTER
;	IF ARG:2 > -1
;		PRINTFORML %CALLNAME:(ARG:2)%に%LOCALS:1%の名前を付けてもらいますか？
;		PRINTL 
;		PRINTL [0] はい
;		PRINTL [1] 自分でつけます
;		$INPUT_LOOP1
;		INPUT
;		IF RESULT == 0
;			CALL CHILD_NAME(ARG, ARG:2)
;			LOCAL = RESULT
;		ELSEIF RESULT == 1
;			LOCAL = 1
;		ELSE
;			GOTO INPUT_LOOP1
;		ENDIF
;	ELSE
;		LOCAL = 0
;	ENDIF
;ELSEIF !ARG:3
;	PRINTFORML %CALLNAME:(ARG:1)%に%LOCALS:1%の名前を付けてもらいますか？
;	PRINTL 
;	PRINTL [0] はい
;	PRINTL [1] 自分でつけます
;	$INPUT_LOOP2
;	INPUT
;	IF RESULT == 0
;		CALL CHILD_NAME(ARG, ARG:1)
;		LOCAL = RESULT
;	ELSEIF RESULT == 1
;		LOCAL = 1
;	ELSE
;		GOTO INPUT_LOOP2
;	ENDIF
;ELSE
	LOCAL = 1
;ENDIF

IF LOCAL
	$CHILDNAME_INPUT1
	PRINTFORML %LOCALS:1%の名前を入力して下さい
	INPUTS
	NAME:ARG = %RESULTS%
	CALLNAME:ARG = %RESULTS%
	PRINTFORML %LOCALS:1%の名前を%NAME:ARG%に決めました
	PRINTFORMW よろしいですか？
	PRINTL 
	PRINTFORML [0] %NAME:ARG%で良い
	PRINTL [1] もう一度考える
	$INPUT_LOOP3
	INPUT
	IF RESULT == 0
	ELSEIF RESULT == 1
		GOTO CHILDNAME_INPUT1
	ELSE
		GOTO INPUT_LOOP3
	ENDIF
	PRINTL 
	PRINTFORML %NAME:ARG%にニックネームを付けますか？
	PRINTL 
	PRINTL [0] はい
	PRINTL [1] いいえ
	$INPUT_LOOP4
	INPUT
	IF RESULT == 0
		$CHILDNAME_INPUT2
		PRINTFORML %LOCALS%のニックネームを入力して下さい
		INPUTS
		CALLNAME:ARG = %RESULTS%
		PRINTFORML %NAME:ARG%のニックネームを%CALLNAME:ARG%に決めました
		PRINTFORMW よろしいですか？
		PRINTL 
		PRINTFORML [0] %CALLNAME:ARG%で良い
		PRINTL [1] もう一度考える
		PRINTL [2] 名前から考え直す
		$INPUT_LOOP5
		INPUT
		IF RESULT == 0
		ELSEIF RESULT == 1
			GOTO CHILDNAME_INPUT2
		ELSEIF RESULT == 2
			GOTO CHILDNAME_INPUT1
		ELSE
			GOTO INPUT_LOOP5
		ENDIF
	ELSEIF RESULT == 1
	ELSE
		GOTO INPUT_LOOP4
	ENDIF
ENDIF
;子供の非表示フラグ
CFLAG:ARG:26 = 1
;父親と母親に子供の名前記録
IF STRLENS(CSTR:(ARG:1):13)
	CSTR:(ARG:1):13 = %CSTR:(ARG:1):13%、%CALLNAME:ARG%
ELSE
	CSTR:(ARG:1):13 = %CALLNAME:ARG%
ENDIF
IF ARG:2 > -1
	IF STRLENS(CSTR:(ARG:2):13)
		CSTR:(ARG:2):13 = %CSTR:(ARG:2):13%、%CALLNAME:ARG%
	ELSE
		CSTR:(ARG:2):13 = %CALLNAME:ARG%
	ENDIF
ENDIF

;-------------------------------------------------
;子供の素質処理
;-------------------------------------------------
@CHILD_TALENT_SET(ARG)
;処女系素質を付ける
SIF PENIS(ARG)
	TALENT:ARG:童貞 = 1
SIF VAGINA(ARG)
	TALENT:ARG:処女 = 1

TALENT:ARG:バックバージン = 1

;ランダムで幼稚
SIF !RAND:3
	TALENT:ARG:幼稚 = 1

;知識が無いので消去
;調合知識/禁断の知識
TALENT:ARG:調合知識 = 0
TALENT:ARG:禁断の知識 = 0

;後天的なものを消去
;ドＳ/ドМ
SIF TALENT:ARG:サド == 2
	TALENT:ARG:サド = 1
SIF TALENT:ARG:マゾ == 2
	TALENT:ARG:マゾ = 1

;打ち消し合う
;反抗的⇔素直
IF TALENT:ARG:反抗的 && TALENT:ARG:素直
	IF !RAND:2
		TALENT:ARG:反抗的 = 0
	ELSE
		TALENT:ARG:素直 = 0
	ENDIF
ENDIF

;プライド高い⇔プライド低い
IF TALENT:ARG:プライド高い && TALENT:ARG:プライド低い
	IF !RAND:2
		TALENT:ARG:プライド高い = 0
	ELSE
		TALENT:ARG:プライド低い = 0
	ENDIF
ENDIF

;無関心⇔好奇心
IF TALENT:ARG:無関心 && TALENT:ARG:好奇心
	IF !RAND:2
		TALENT:ARG:無関心 = 0
	ELSE
		TALENT:ARG:好奇心 = 0
	ENDIF
ENDIF

;楽観的⇔悲観的
IF TALENT:ARG:楽観的 && TALENT:ARG:悲観的
	IF !RAND:2
		TALENT:ARG:楽観的 = 0
	ELSE
		TALENT:ARG:悲観的 = 0
	ENDIF
ENDIF

;貞操観念⇔貞操無頓着
IF TALENT:ARG:貞操観念 && TALENT:ARG:貞操無頓着
	IF !RAND:2
		TALENT:ARG:貞操観念 = 0
	ELSE
		TALENT:ARG:貞操無頓着 = 0
	ENDIF
ENDIF

;抑圧⇔解放
IF TALENT:ARG:抑圧 && TALENT:ARG:解放
	IF !RAND:2
		TALENT:ARG:抑圧 = 0
	ELSE
		TALENT:ARG:解放 = 0
	ENDIF
ENDIF

;恥じらい⇔恥薄い
IF TALENT:ARG:恥じらい && TALENT:ARG:恥薄い
	IF !RAND:2
		TALENT:ARG:恥じらい = 0
	ELSE
		TALENT:ARG:恥薄い = 0
	ENDIF
ENDIF

;痛みに弱い⇔痛みに強い
IF TALENT:ARG:痛みに弱い && TALENT:ARG:痛みに強い
	IF !RAND:2
		TALENT:ARG:痛みに弱い = 0
	ELSE
		TALENT:ARG:痛みに強い = 0
	ENDIF
ENDIF

;濡れやすい⇔濡れにくい
IF TALENT:ARG:濡れやすい && TALENT:ARG:濡れにくい
	IF !RAND:2
		TALENT:ARG:濡れやすい = 0
	ELSE
		TALENT:ARG:濡れにくい = 0
	ENDIF
ENDIF

;メシマズ⇔料理上手
IF TALENT:ARG:メシマズ && TALENT:ARG:料理上手
	IF !RAND:2
		TALENT:ARG:メシマズ = 0
	ELSE
		TALENT:ARG:料理上手 = 0
	ENDIF
ENDIF

;習得早い⇔習得遅い
IF TALENT:ARG:習得早い && TALENT:ARG:習得遅い
	IF !RAND:2
		TALENT:ARG:習得早い = 0
	ELSE
		TALENT:ARG:習得遅い = 0
	ENDIF
ENDIF

;汚臭鈍感⇔汚臭敏感
IF TALENT:ARG:汚臭鈍感 && TALENT:ARG:汚臭敏感
	IF !RAND:2
		TALENT:ARG:汚臭鈍感 = 0
	ELSE
		TALENT:ARG:汚臭敏感 = 0
	ENDIF
ENDIF

;スキンシップ好き⇔スキンシップ苦手
IF TALENT:ARG:スキンシップ好き && TALENT:ARG:スキンシップ苦手
	IF !RAND:2
		TALENT:ARG:スキンシップ好き = 0
	ELSE
		TALENT:ARG:スキンシップ苦手 = 0
	ENDIF
ENDIF

;快感に素直⇔快感の否定
IF TALENT:ARG:快感に素直 && TALENT:ARG:快感の否定
	IF !RAND:2
		TALENT:ARG:快感に素直 = 0
	ELSE
		TALENT:ARG:快感の否定 = 0
	ENDIF
ENDIF

;両刀⇔男嫌い/女嫌い
IF TALENT:ARG:両刀 && (TALENT:ARG:男嫌い || TALENT:ARG:女嫌い)
	IF !RAND:2
		TALENT:ARG:両刀 = 0
	ELSE
		TALENT:ARG:男嫌い = 0
		TALENT:ARG:女嫌い = 0
	ENDIF
ENDIF

;胸の大きさ系素質
IF TALENT:ARG:貧乳
	LOCAL:(LOCAL:4) = 109
	LOCAL:4++
ENDIF
IF TALENT:ARG:絶壁
	LOCAL:(LOCAL:4) = 110
	LOCAL:4++
ENDIF
IF TALENT:ARG:巨乳
	LOCAL:(LOCAL:4) = 111
	LOCAL:4++
ENDIF
IF TALENT:ARG:爆乳
	LOCAL:(LOCAL:4) = 112
	LOCAL:4++
ENDIF
IF LOCAL:4
	LOCAL:5 = RAND:(LOCAL:4)
	SIF LOCAL:(LOCAL:5) != 109
		TALENT:ARG:貧乳 = 0
	SIF LOCAL:(LOCAL:5) != 110
		TALENT:ARG:絶壁 = 0
	SIF LOCAL:(LOCAL:5) != 111
		TALENT:ARG:巨乳 = 0
	SIF LOCAL:(LOCAL:5) != 112
		TALENT:ARG:爆乳 = 0
ENDIF
IF !RAND:2
	TALENT:ARG:貧乳 = 0
	TALENT:ARG:絶壁 = 0
	TALENT:ARG:巨乳 = 0
	TALENT:ARG:爆乳 = 0
ENDIF

;ちんこの大きさ系素質
IF TALENT:ARG:子供サイズ
	LOCAL:(LOCAL:4) = 114
	LOCAL:4++
ENDIF
IF TALENT:ARG:短小
	LOCAL:(LOCAL:4) = 115
	LOCAL:4++
ENDIF
IF TALENT:ARG:巨根
	LOCAL:(LOCAL:4) = 116
	LOCAL:4++
ENDIF
IF TALENT:ARG:馬並み
	LOCAL:(LOCAL:4) = 117
	LOCAL:4++
ENDIF
IF LOCAL:4
	LOCAL:5 = RAND:(LOCAL:4)
	SIF LOCAL:(LOCAL:5) != 114
		TALENT:ARG:子供サイズ = 0
	SIF LOCAL:(LOCAL:5) != 115
		TALENT:ARG:短小 = 0
	SIF LOCAL:(LOCAL:5) != 116
		TALENT:ARG:巨根 = 0
	SIF LOCAL:(LOCAL:5) != 117
		TALENT:ARG:馬並み = 0
ENDIF
IF !RAND:3
	TALENT:ARG:子供サイズ = 0
	TALENT:ARG:短小 = 0
	TALENT:ARG:巨根 = 0
	TALENT:ARG:馬並み = 0
ENDIF
SIF !RAND:2
	TALENT:ARG:パイパン = 1
SIF !RAND:2
	TALENT:ARG:包茎 = 1

;体型素質
IF TALENT:ARG:小柄体型
	LOCAL:(LOCAL:4) = 100
	LOCAL:4++
ENDIF
IF TALENT:ARG:大柄体型
	LOCAL:(LOCAL:4) = 113
	LOCAL:4++
ENDIF
IF TALENT:ARG:小人体型
	LOCAL:(LOCAL:4) = 142
	LOCAL:4++
ENDIF
IF LOCAL:4
	LOCAL:5 = RAND:(LOCAL:4)
	SIF LOCAL:(LOCAL:5) != 100
		TALENT:ARG:小柄体型 = 0
	SIF LOCAL:(LOCAL:5) != 113
		TALENT:ARG:大柄体型 = 0
	SIF LOCAL:(LOCAL:5) != 142
		TALENT:ARG:小人体型 = 0
ENDIF
IF !RAND:2
	TALENT:ARG:小柄体型 = 0
	TALENT:ARG:大柄体型 = 0
	TALENT:ARG:小人体型 = 0
ENDIF

;回復早い⇔回復遅い
IF TALENT:ARG:回復早い && TALENT:ARG:回復遅い
	IF !RAND:2
		TALENT:ARG:回復早い = 0
	ELSE
		TALENT:ARG:回復遅い = 0
	ENDIF
ENDIF

;男嫌い⇔男好き
IF TALENT:ARG:男嫌い && TALENT:ARG:男好き
	IF !RAND:2
		TALENT:ARG:男嫌い = 0
	ELSE
		TALENT:ARG:男好き = 0
	ENDIF
ENDIF

;女嫌い⇔女好き
IF TALENT:ARG:女嫌い && TALENT:ARG:女好き
	IF !RAND:2
		TALENT:ARG:女嫌い = 0
	ELSE
		TALENT:ARG:女好き = 0
	ENDIF
ENDIF

